<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STAND-BY-ME 3D | Arcade Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --panel-bg: #1a1a1a;
            --border-grey: #444;
            --neon-pink: #ff2d75;
            --neon-blue: #00d2ff;
            --neon-green: #39ff14;
        }

        body {
            background: #0f0f12;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Segoe UI', sans-serif;
            padding-top: 20px;
        }

        h1.title {
            font-style: italic;
            font-weight: 900;
            font-size: 3rem;
            margin: 0 0 20px 0;
            text-shadow: 0 0 20px var(--neon-pink);
        }

        /* Main Console Frame */
        .arcade-frame {
            background: #2b2b2b;
            padding: 25px;
            border-radius: 40px;
            border: 8px solid #3d3d3d;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            display: grid;
            grid-template-columns: 600px 300px;
            grid-template-rows: 400px 220px;
            gap: 20px;
            position: relative;
        }

        /* 3D Viewport */
        .viewport-container {
            grid-column: 1;
            grid-row: 1;
            background: #000;
            border: 4px solid #111;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        canvas { width: 100% !important; height: 100% !important; cursor: crosshair; }

        /* Sidebar Modules */
        .sidebar {
            grid-column: 2;
            grid-row: 1 / span 2;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .module {
            background: #111;
            border-radius: 10px;
            padding: 12px;
            border: 1px solid #333;
        }

        .module-header {
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--neon-pink);
            text-transform: uppercase;
            border-bottom: 1px solid #222;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .stat-row { display: flex; justify-content: space-between; font-family: monospace; font-size: 0.9rem; margin-bottom: 4px; }
        .progress-mini { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; margin-top: 4px; }
        .fill-blue { background: var(--neon-blue); height: 100%; }

        /* Bottom Control Dashboard */
        .dashboard {
            grid-column: 1;
            grid-row: 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .dash-panel { background: #1a1a1a; border-radius: 15px; padding: 15px; border: 1px solid #333; position: relative; }

        /* Overlay */
        .overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10;
        }

        .btn-start {
            background: #d33; color: white; border: none; padding: 10px 30px;
            font-weight: bold; border-radius: 5px; cursor: pointer;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <h1 class="title">STAND-BY-ME 3D</h1>

    <div class="arcade-frame">
        <div class="viewport-container">
            <canvas id="gameCanvas"></canvas>
            <div id="ui-start" class="overlay">
                <button class="btn-start" onclick="startGame()">START</button>
            </div>
            <div id="ui-over" class="overlay hidden">
                <h2 style="color:var(--neon-pink)">GAME OVER</h2>
                <button class="btn-start" onclick="location.reload()">RETRY</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="module">
                <div class="module-header">STAGES <span>(II)</span></div>
                <div class="stat-row"><span>Active</span> <div class="progress-mini" style="width:100px"><div class="fill-blue" style="width:70%"></div></div></div>
                <div class="stat-row"><span>Sapphire</span> <div class="progress-mini" style="width:100px"><div class="fill-blue" style="width:30%; background:yellow"></div></div></div>
            </div>

            <div class="module">
                <div class="module-header">OBJECTIVE</div>
                <div style="background:#fff; color:#000; padding:4px; font-size:0.8rem; font-weight:bold">Next: Sapphire Level</div>
            </div>

            <div class="module">
                <div class="module-header">SKINEL</div>
                <div class="stat-row">SCORE: <span id="scoreText" style="color:var(--neon-green)">0</span></div>
                <div class="stat-row">BEST: <span id="bestText" style="color:var(--neon-green)">0</span></div>
            </div>
        </div>

        <div class="dashboard">
            <div class="dash-panel">
                <div class="module-header">Tutorial Overlay</div>
                <p style="font-size: 0.7rem; color:#888">Hook the bottle. Stand it upright. Don't let it slip off the platform.</p>
                <div class="stat-row">STAMINA: <span id="livesText">❤️❤️❤️</span></div>
            </div>
            <div class="dash-panel">
                <div class="module-header">RESATRTN</div>
                <div class="stat-row">LEVEL: <span id="levelText" style="color:var(--neon-blue)">1</span></div>
                <button class="btn-start" style="width:100%; background:#444" onclick="location.reload()">QUIT</button>
            </div>
        </div>
    </div>

<script>
// --- CORE GAME ENGINE (Restoring movements and 3D) ---
const canvas = document.getElementById("gameCanvas");
let scene, camera, renderer, bottle, ring, rope;

const state = {
    active: false,
    level: 1, score: 0, lives: 3,
    bX: 300, bAngle: 0, bVel: 0,
    rX: 300, rY: 100, rVX: 0, rVY: 0,
    mX: 300, mY: 50,
    hooked: false, dragging: false
};

function init3D() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050505);

    camera = new THREE.PerspectiveCamera(45, 600 / 400, 1, 1000);
    camera.position.set(0, 50, 450);

    renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(600, 400);

    // Grid Floor (Matching the look in your image)
    const grid = new THREE.GridHelper(1000, 40, 0x333333, 0x111111);
    grid.position.y = -80;
    scene.add(grid);

    // Lighting
    const light = new THREE.PointLight(0xffffff, 1, 500);
    light.position.set(0, 100, 100);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x444444));

    // Bottle
    bottle = new THREE.Group();
    const body = new THREE.Mesh(
        new THREE.CylinderGeometry(18, 22, 120, 16),
        new THREE.MeshPhongMaterial({ color: 0x00aaff, transparent:true, opacity:0.7 })
    );
    body.rotation.z = Math.PI/2; body.position.x = 60;
    bottle.add(body);
    const cap = new THREE.Mesh(new THREE.CylinderGeometry(8, 8, 15), new THREE.MeshBasicMaterial({color:0xff3333}));
    cap.rotation.z = Math.PI/2; cap.position.x = 130;
    bottle.add(cap);
    scene.add(bottle);

    // Ring
    ring = new THREE.Mesh(new THREE.TorusGeometry(18, 3, 16, 40), new THREE.MeshBasicMaterial({color:0xffffff}));
    scene.add(ring);

    // Rope
    rope = new THREE.Line(new THREE.BufferGeometry(), new THREE.LineBasicMaterial({color:0x888888}));
    scene.add(rope);
}

function update() {
    if (!state.active) return;

    // Physics
    state.rVX += (state.mX - state.rX) * 0.05;
    state.rVY += (state.mY - state.rY) * 0.05 + 0.8;
    state.rX += state.rVX; state.rY += state.rVY;
    state.rVX *= 0.92; state.rVY *= 0.92;

    const cX = state.bX + Math.cos(state.bAngle) * 150;
    const cY = 320 + Math.sin(state.bAngle) * 150;

    if (state.hooked) {
        if (Math.hypot(state.rX - cX, state.rY - cY) > 80) {
            state.hooked = false;
        } else {
            const target = Math.atan2(state.rY - 320, state.rX - state.bX);
            state.bAngle += (target - state.bAngle) * 0.15;
            state.bVel += (state.rX - cX) * 0.05;
        }
    } else {
        if (state.bAngle < 0) state.bAngle += 0.06;
        if (state.bAngle < -0.8) resetRound("Tipped!");
        if (state.bAngle > 0) state.bAngle = 0;
        state.bVel += (300 - state.bX) * 0.04;
    }

    state.bX += state.bVel;
    state.bVel *= 0.95;

    // Boundary
    if (state.bX < 50 || state.bX > 550) resetRound("Fell!");

    // Win Check
    if (state.bAngle <= -1.48 && Math.abs(state.bVel) < 0.2) {
        state.score += 100;
        state.level++;
        document.getElementById("scoreText").innerText = state.score;
        document.getElementById("levelText").innerText = state.level;
        resetRound();
    }
}

function render() {
    bottle.position.set(state.bX - 300, -75, 0);
    bottle.rotation.z = state.bAngle;
    
    ring.position.set(state.rX - 300, -(state.rY - 200), 0);
    
    const points = [new THREE.Vector3(0, 200, 0), ring.position.clone()];
    rope.geometry.setFromPoints(points);

    renderer.render(scene, camera);
}

function startGame() {
    state.active = true;
    document.getElementById("ui-start").classList.add("hidden");
}

function resetRound(msg) {
    if (msg) state.lives--;
    document.getElementById("livesText").innerText = "❤️".repeat(state.lives);
    if (state.lives <= 0) {
        state.active = false;
        document.getElementById("ui-over").classList.remove("hidden");
    }
    state.bX = 300; state.bAngle = 0; state.bVel = 0;
    state.rX = 300; state.rY = 100; state.hooked = false;
}

// Controls
canvas.addEventListener('mousedown', e => {
    state.dragging = true;
});
window.addEventListener('mousemove', e => {
    const r = canvas.getBoundingClientRect();
    state.mX = (e.clientX - r.left) * (600 / r.width);
    state.mY = (e.clientY - r.top) * (400 / r.height);
    if (state.dragging && !state.hooked) {
        const cX = state.bX + Math.cos(state.bAngle) * 150;
        const cY = 320 + Math.sin(state.bAngle) * 150;
        if (Math.hypot(state.rX - cX, state.rY - cY) < 30) state.hooked = true;
    }
});
window.addEventListener('mouseup', () => state.dragging = false);

window.onload = () => {
    init3D();
    function loop() { update(); render(); requestAnimationFrame(loop); }
    loop();
};
</script>
</body>
</html>
